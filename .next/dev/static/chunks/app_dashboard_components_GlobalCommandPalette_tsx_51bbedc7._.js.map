{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/bolad/Downloads/SoloBotAgency_SaaS_Starter/app/dashboard/components/GlobalCommandPalette.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState, useMemo } from 'react';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\nimport { Command, Search, Bot, ArrowRight, Activity, Pause, Play, Layers } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ntype CommandItem = {\r\n  id: string;\r\n  label: string;\r\n  group: 'Navigation' | 'Actions' | 'Deals';\r\n  icon: React.ReactNode;\r\n  shortcut?: string;\r\n  action: () => void;\r\n};\r\n\r\nexport default function GlobalCommandPalette() {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [query, setQuery] = useState('');\r\n  const [selectedIndex, setSelectedIndex] = useState(0);\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n\r\n  // Load deals for dynamic commands\r\n  const [deals, setDeals] = useState<any[]>([]);\r\n\r\n  useEffect(() => {\r\n    const down = (e: KeyboardEvent) => {\r\n      if (e.key === 'k' && (e.metaKey || e.ctrlKey)) {\r\n        e.preventDefault();\r\n        setIsOpen((open) => !open);\r\n        // Refresh deals from persistence on open to ensure data is fresh\r\n        const stored = localStorage.getItem('sales-os-v1');\r\n        if (stored) {\r\n          try {\r\n            const parsed = JSON.parse(stored);\r\n            if (parsed.states) setDeals(Object.values(parsed.states));\r\n          } catch (e) {}\r\n        }\r\n      }\r\n      if (e.key === 'Escape') setIsOpen(false);\r\n    };\r\n    document.addEventListener('keydown', down);\r\n    return () => document.removeEventListener('keydown', down);\r\n  }, []);\r\n\r\n  // Command Execution Logic\r\n  const executeCommand = (cmd: CommandItem) => {\r\n    cmd.action();\r\n    setIsOpen(false);\r\n    setQuery('');\r\n  };\r\n\r\n  // Helper to modify local persistence store directly from global context\r\n  const modifyActiveDealState = (updates: any) => {\r\n    const stored = localStorage.getItem('sales-os-v1');\r\n    if (!stored) return;\r\n    try {\r\n      const parsed = JSON.parse(stored);\r\n      // Determine active deal from URL query param or fallback to default\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const activeId = urlParams.get('deal') || 'deal-1'; \r\n      \r\n      if (parsed.states[activeId]) {\r\n        parsed.states[activeId] = { ...parsed.states[activeId], ...updates };\r\n        localStorage.setItem('sales-os-v1', JSON.stringify(parsed));\r\n        \r\n        // Force refresh if on agent page to show state change immediately\r\n        if (pathname.includes('ai-sales-agent')) {\r\n          window.location.reload(); \r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Failed to execute global command\", e);\r\n    }\r\n  };\r\n\r\n  const commands: CommandItem[] = useMemo(() => {\r\n    const list: CommandItem[] = [\r\n      {\r\n        id: 'nav-deals',\r\n        label: 'Go to All Deals',\r\n        group: 'Navigation',\r\n        icon: <Layers size={14} />,\r\n        action: () => router.push('/dashboard/deals'),\r\n      },\r\n      {\r\n        id: 'nav-agent',\r\n        label: 'Go to AI Sales Agent',\r\n        group: 'Navigation',\r\n        icon: <Bot size={14} />,\r\n        action: () => router.push('/dashboard/ai-sales-agent'),\r\n      },\r\n      {\r\n        id: 'act-pause',\r\n        label: 'Pause Current Deal',\r\n        group: 'Actions',\r\n        icon: <Pause size={14} />,\r\n        action: () => modifyActiveDealState({ status: 'paused', health: 'at_risk' }),\r\n      },\r\n      {\r\n        id: 'act-resume',\r\n        label: 'Resume Current Deal',\r\n        group: 'Actions',\r\n        icon: <Play size={14} />,\r\n        action: () => modifyActiveDealState({ status: 'active', health: 'healthy' }),\r\n      }\r\n    ];\r\n\r\n    // Dynamic Deal Switching\r\n    deals.forEach((deal) => {\r\n      list.push({\r\n        id: `switch-${deal.dealId}`,\r\n        label: `Switch to ${deal.dealName}`,\r\n        group: 'Deals',\r\n        icon: <ArrowRight size={14} />,\r\n        action: () => {\r\n          router.push(`/dashboard/ai-sales-agent?deal=${deal.dealId}`);\r\n          // Trigger a reload if we are already on the page to force state refresh\r\n          if (pathname.includes('ai-sales-agent')) {\r\n             setTimeout(() => window.location.href = `/dashboard/ai-sales-agent?deal=${deal.dealId}`, 50);\r\n          }\r\n        },\r\n      });\r\n    });\r\n\r\n    return list.filter(item => \r\n      item.label.toLowerCase().includes(query.toLowerCase())\r\n    );\r\n  }, [query, deals, router, pathname]);\r\n\r\n  // Keyboard navigation within palette\r\n  useEffect(() => {\r\n    const handleNav = (e: KeyboardEvent) => {\r\n      if (!isOpen) return;\r\n      if (e.key === 'ArrowDown') {\r\n        e.preventDefault();\r\n        setSelectedIndex(i => (i + 1) % commands.length);\r\n      }\r\n      if (e.key === 'ArrowUp') {\r\n        e.preventDefault();\r\n        setSelectedIndex(i => (i - 1 + commands.length) % commands.length);\r\n      }\r\n      if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        if (commands[selectedIndex]) executeCommand(commands[selectedIndex]);\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleNav);\r\n    return () => window.removeEventListener('keydown', handleNav);\r\n  }, [isOpen, commands, selectedIndex]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[100] flex items-start justify-center bg-black/60 pt-[15vh] backdrop-blur-sm\">\r\n      <motion.div \r\n        initial={{ opacity: 0, scale: 0.95, y: -20 }}\r\n        animate={{ opacity: 1, scale: 1, y: 0 }}\r\n        exit={{ opacity: 0, scale: 0.95 }}\r\n        transition={{ duration: 0.1 }}\r\n        className=\"flex w-full max-w-lg flex-col overflow-hidden rounded-xl border border-zinc-800 bg-zinc-950 shadow-2xl ring-1 ring-white/10\"\r\n      >\r\n        <div className=\"flex items-center border-b border-zinc-800 px-4\">\r\n          <Search size={16} className=\"text-zinc-500\" />\r\n          <input\r\n            autoFocus\r\n            value={query}\r\n            onChange={(e) => { setQuery(e.target.value); setSelectedIndex(0); }}\r\n            placeholder=\"Type a command (Switch, Pause, Go to)...\"\r\n            className=\"h-14 flex-1 bg-transparent px-3 text-sm text-zinc-100 placeholder:text-zinc-600 focus:outline-none\"\r\n          />\r\n          <div className=\"flex items-center gap-1 rounded bg-zinc-900 px-1.5 py-0.5 text-[10px] font-medium text-zinc-500 border border-zinc-800\">\r\n            <span className=\"text-xs\">ESC</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"max-h-[60vh] overflow-y-auto p-2 scrollbar-thin scrollbar-thumb-zinc-800\">\r\n          {commands.length === 0 ? (\r\n            <div className=\"py-8 text-center text-xs text-zinc-500\">No commands found.</div>\r\n          ) : (\r\n            <div className=\"flex flex-col gap-1\">\r\n              {['Navigation', 'Actions', 'Deals'].map((group) => {\r\n                const groupItems = commands.filter(c => c.group === group);\r\n                if (groupItems.length === 0) return null;\r\n                return (\r\n                  <div key={group}>\r\n                    <div className=\"px-2 py-1.5 text-[10px] font-semibold uppercase tracking-wider text-zinc-600\">\r\n                      {group}\r\n                    </div>\r\n                    {groupItems.map((item, idx) => {\r\n                      // Calculate global index for highlighting\r\n                      const globalIdx = commands.indexOf(item);\r\n                      const isSelected = globalIdx === selectedIndex;\r\n                      return (\r\n                        <button\r\n                          key={item.id}\r\n                          onClick={() => executeCommand(item)}\r\n                          onMouseEnter={() => setSelectedIndex(globalIdx)}\r\n                          className={`flex w-full items-center gap-3 rounded-lg px-3 py-2.5 text-left text-sm transition-colors ${\r\n                            isSelected ? 'bg-indigo-600 text-white' : 'text-zinc-400 hover:bg-zinc-900'\r\n                          }`}\r\n                        >\r\n                          <div className={`flex h-5 w-5 items-center justify-center ${isSelected ? 'text-indigo-200' : 'text-zinc-600'}`}>\r\n                            {item.icon}\r\n                          </div>\r\n                          <span className=\"flex-1\">{item.label}</span>\r\n                          {isSelected && <ArrowRight size={14} className=\"opacity-50\" />}\r\n                        </button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        <div className=\"flex items-center justify-between border-t border-zinc-800 bg-zinc-900/50 px-4 py-2 text-[10px] text-zinc-500\">\r\n          <div className=\"flex gap-3\">\r\n            <span>↑↓ to navigate</span>\r\n            <span>↵ to select</span>\r\n          </div>\r\n          <span>SalesOS v2.4</span>\r\n        </div>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;AALA;;;;;AAgBe,SAAS;;IACtB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,WAAW,IAAA,oJAAW;IAE5B,kCAAkC;IAClC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAQ,EAAE;IAE5C,IAAA,0KAAS;0CAAC;YACR,MAAM;uDAAO,CAAC;oBACZ,IAAI,EAAE,GAAG,KAAK,OAAO,CAAC,EAAE,OAAO,IAAI,EAAE,OAAO,GAAG;wBAC7C,EAAE,cAAc;wBAChB;mEAAU,CAAC,OAAS,CAAC;;wBACrB,iEAAiE;wBACjE,MAAM,SAAS,aAAa,OAAO,CAAC;wBACpC,IAAI,QAAQ;4BACV,IAAI;gCACF,MAAM,SAAS,KAAK,KAAK,CAAC;gCAC1B,IAAI,OAAO,MAAM,EAAE,SAAS,OAAO,MAAM,CAAC,OAAO,MAAM;4BACzD,EAAE,OAAO,GAAG,CAAC;wBACf;oBACF;oBACA,IAAI,EAAE,GAAG,KAAK,UAAU,UAAU;gBACpC;;YACA,SAAS,gBAAgB,CAAC,WAAW;YACrC;kDAAO,IAAM,SAAS,mBAAmB,CAAC,WAAW;;QACvD;yCAAG,EAAE;IAEL,0BAA0B;IAC1B,MAAM,iBAAiB,CAAC;QACtB,IAAI,MAAM;QACV,UAAU;QACV,SAAS;IACX;IAEA,wEAAwE;IACxE,MAAM,wBAAwB,CAAC;QAC7B,MAAM,SAAS,aAAa,OAAO,CAAC;QACpC,IAAI,CAAC,QAAQ;QACb,IAAI;YACF,MAAM,SAAS,KAAK,KAAK,CAAC;YAC1B,oEAAoE;YACpE,MAAM,YAAY,IAAI,gBAAgB,OAAO,QAAQ,CAAC,MAAM;YAC5D,MAAM,WAAW,UAAU,GAAG,CAAC,WAAW;YAE1C,IAAI,OAAO,MAAM,CAAC,SAAS,EAAE;gBAC3B,OAAO,MAAM,CAAC,SAAS,GAAG;oBAAE,GAAG,OAAO,MAAM,CAAC,SAAS;oBAAE,GAAG,OAAO;gBAAC;gBACnE,aAAa,OAAO,CAAC,eAAe,KAAK,SAAS,CAAC;gBAEnD,kEAAkE;gBAClE,IAAI,SAAS,QAAQ,CAAC,mBAAmB;oBACvC,OAAO,QAAQ,CAAC,MAAM;gBACxB;YACF;QACF,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,oCAAoC;QACpD;IACF;IAEA,MAAM,WAA0B,IAAA,wKAAO;kDAAC;YACtC,MAAM,OAAsB;gBAC1B;oBACE,IAAI;oBACJ,OAAO;oBACP,OAAO;oBACP,oBAAM,6LAAC,mNAAM;wBAAC,MAAM;;;;;;oBACpB,MAAM;kEAAE,IAAM,OAAO,IAAI,CAAC;;gBAC5B;gBACA;oBACE,IAAI;oBACJ,OAAO;oBACP,OAAO;oBACP,oBAAM,6LAAC,0MAAG;wBAAC,MAAM;;;;;;oBACjB,MAAM;kEAAE,IAAM,OAAO,IAAI,CAAC;;gBAC5B;gBACA;oBACE,IAAI;oBACJ,OAAO;oBACP,OAAO;oBACP,oBAAM,6LAAC,gNAAK;wBAAC,MAAM;;;;;;oBACnB,MAAM;kEAAE,IAAM,sBAAsB;gCAAE,QAAQ;gCAAU,QAAQ;4BAAU;;gBAC5E;gBACA;oBACE,IAAI;oBACJ,OAAO;oBACP,OAAO;oBACP,oBAAM,6LAAC,6MAAI;wBAAC,MAAM;;;;;;oBAClB,MAAM;kEAAE,IAAM,sBAAsB;gCAAE,QAAQ;gCAAU,QAAQ;4BAAU;;gBAC5E;aACD;YAED,yBAAyB;YACzB,MAAM,OAAO;0DAAC,CAAC;oBACb,KAAK,IAAI,CAAC;wBACR,IAAI,CAAC,OAAO,EAAE,KAAK,MAAM,EAAE;wBAC3B,OAAO,CAAC,UAAU,EAAE,KAAK,QAAQ,EAAE;wBACnC,OAAO;wBACP,oBAAM,6LAAC,mOAAU;4BAAC,MAAM;;;;;;wBACxB,MAAM;sEAAE;gCACN,OAAO,IAAI,CAAC,CAAC,+BAA+B,EAAE,KAAK,MAAM,EAAE;gCAC3D,wEAAwE;gCACxE,IAAI,SAAS,QAAQ,CAAC,mBAAmB;oCACtC;kFAAW,IAAM,OAAO,QAAQ,CAAC,IAAI,GAAG,CAAC,+BAA+B,EAAE,KAAK,MAAM,EAAE;iFAAE;gCAC5F;4BACF;;oBACF;gBACF;;YAEA,OAAO,KAAK,MAAM;0DAAC,CAAA,OACjB,KAAK,KAAK,CAAC,WAAW,GAAG,QAAQ,CAAC,MAAM,WAAW;;QAEvD;iDAAG;QAAC;QAAO;QAAO;QAAQ;KAAS;IAEnC,qCAAqC;IACrC,IAAA,0KAAS;0CAAC;YACR,MAAM;4DAAY,CAAC;oBACjB,IAAI,CAAC,QAAQ;oBACb,IAAI,EAAE,GAAG,KAAK,aAAa;wBACzB,EAAE,cAAc;wBAChB;wEAAiB,CAAA,IAAK,CAAC,IAAI,CAAC,IAAI,SAAS,MAAM;;oBACjD;oBACA,IAAI,EAAE,GAAG,KAAK,WAAW;wBACvB,EAAE,cAAc;wBAChB;wEAAiB,CAAA,IAAK,CAAC,IAAI,IAAI,SAAS,MAAM,IAAI,SAAS,MAAM;;oBACnE;oBACA,IAAI,EAAE,GAAG,KAAK,SAAS;wBACrB,EAAE,cAAc;wBAChB,IAAI,QAAQ,CAAC,cAAc,EAAE,eAAe,QAAQ,CAAC,cAAc;oBACrE;gBACF;;YACA,OAAO,gBAAgB,CAAC,WAAW;YACnC;kDAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;;QACrD;yCAAG;QAAC;QAAQ;QAAU;KAAc;IAEpC,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC,uMAAM,CAAC,GAAG;YACT,SAAS;gBAAE,SAAS;gBAAG,OAAO;gBAAM,GAAG,CAAC;YAAG;YAC3C,SAAS;gBAAE,SAAS;gBAAG,OAAO;gBAAG,GAAG;YAAE;YACtC,MAAM;gBAAE,SAAS;gBAAG,OAAO;YAAK;YAChC,YAAY;gBAAE,UAAU;YAAI;YAC5B,WAAU;;8BAEV,6LAAC;oBAAI,WAAU;;sCACb,6LAAC,mNAAM;4BAAC,MAAM;4BAAI,WAAU;;;;;;sCAC5B,6LAAC;4BACC,SAAS;4BACT,OAAO;4BACP,UAAU,CAAC;gCAAQ,SAAS,EAAE,MAAM,CAAC,KAAK;gCAAG,iBAAiB;4BAAI;4BAClE,aAAY;4BACZ,WAAU;;;;;;sCAEZ,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;;;;;;8BAI9B,6LAAC;oBAAI,WAAU;8BACZ,SAAS,MAAM,KAAK,kBACnB,6LAAC;wBAAI,WAAU;kCAAyC;;;;;6CAExD,6LAAC;wBAAI,WAAU;kCACZ;4BAAC;4BAAc;4BAAW;yBAAQ,CAAC,GAAG,CAAC,CAAC;4BACvC,MAAM,aAAa,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;4BACpD,IAAI,WAAW,MAAM,KAAK,GAAG,OAAO;4BACpC,qBACE,6LAAC;;kDACC,6LAAC;wCAAI,WAAU;kDACZ;;;;;;oCAEF,WAAW,GAAG,CAAC,CAAC,MAAM;wCACrB,0CAA0C;wCAC1C,MAAM,YAAY,SAAS,OAAO,CAAC;wCACnC,MAAM,aAAa,cAAc;wCACjC,qBACE,6LAAC;4CAEC,SAAS,IAAM,eAAe;4CAC9B,cAAc,IAAM,iBAAiB;4CACrC,WAAW,CAAC,0FAA0F,EACpG,aAAa,6BAA6B,mCAC1C;;8DAEF,6LAAC;oDAAI,WAAW,CAAC,yCAAyC,EAAE,aAAa,oBAAoB,iBAAiB;8DAC3G,KAAK,IAAI;;;;;;8DAEZ,6LAAC;oDAAK,WAAU;8DAAU,KAAK,KAAK;;;;;;gDACnC,4BAAc,6LAAC,mOAAU;oDAAC,MAAM;oDAAI,WAAU;;;;;;;2CAX1C,KAAK,EAAE;;;;;oCAclB;;+BAxBQ;;;;;wBA2Bd;;;;;;;;;;;8BAKN,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;8CAAK;;;;;;8CACN,6LAAC;8CAAK;;;;;;;;;;;;sCAER,6LAAC;sCAAK;;;;;;;;;;;;;;;;;;;;;;;AAKhB;GApNwB;;QAIP,kJAAS;QACP,oJAAW;;;KALN"}}]
}